
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "SVC_HUBBLE"."VW_CORRESPONDENCE" ("CORRESPONDENCE_NAME", "FULL_TITLE", "R_CREATION_DATE", "R_MODIFY_DATE", "R_MODIFIER", "BUSINESS_UNIT", "CLASSIFICATION_ARTIFACT", "CLASSIFICATION_DOMAIN", "CLASSIFICATION_GROUP", "CLASSIFICATION_SUBGROUP", "DOCUMENT_STATUS", "DOCUMENT_DATE", "INFORMATION_CLASSIFICATION", "IS_ACTIVE", "IS_ASSEMBLY", "IS_GENERAL", "R_OBJECT_ID", "DOCUMENT_R_OBJECT_ID", "APPLICATION_TYPE_NAME", "APPLICATION_TYPE_UID", "DOCUMENT_LANGUAGE", "GLOBAL_PRODUCT_NAME", "ORIGINATOR_COUNTRY_NAME", "ORIGINATOR_COUNTRY_UID", "PRODUCT_FAMILY_NAME", "PRODUCT_FAMILY_UID", "REGULATORY_APPLICATION_NAME", "REGULATORY_APPLICATION_UID", "TYPE_OF_COMMUNICATION", "ASSOCIATED_APPLICATION_NUMBER", "ASSOCIATED_ACTIVITY", "MARKET_NAME", "CORRESPONDENCE_ID", "SUBMISSION_ID", "R_VERSION_LABEL", "DURATION", "DOCUMENT_URL", "ROSTER_REGION", "IS_EEA", "IS_EU") DEFAULT COLLATION "USING_NLS_COMP"  AS 
  with First_View as (
SELECT DISTINCT
       A.OBJECT_NAME AS Correspondence_Name,
       A.FULL_TITLE,
       A.R_CREATION_DATE,
       A.R_MODIFY_DATE,
       A.R_MODIFIER,
       A.BUSINESS_UNIT,
       A.CLASSIFICATION_ARTIFACT,
       A.CLASSIFICATION_DOMAIN,
       A.CLASSIFICATION_GROUP,
       A.CLASSIFICATION_SUBGROUP,
       A.DOCUMENT_STATUS,
       A.DOCUMENT_DATE,
       A.INFORMATION_CLASSIFICATION,
       NVL (d.is_active, A.IS_ACTIVE) AS is_active,
       A.IS_ASSEMBLY,
       A.IS_GENERAL,
       A.r_object_id,
       B.DOCUMENT_R_OBJECT_ID,
       B.APPLICATION_TYPE_NAME,
       B.APPLICATION_TYPE_UID,
       B.DOCUMENT_LANGUAGE,
       B.GLOBAL_PRODUCT_NAME,
       B.ORIGINATOR_COUNTRY_NAME,
       B.ORIGINATOR_COUNTRY_UID,
       B.PRODUCT_FAMILY_NAME,
       B.PRODUCT_FAMILY_UID,
       B.REGULATORY_APPLICATION_NAME,
       B.REGULATORY_APPLICATION_UID,
       B.TYPE_OF_COMMUNICATION,
       E.APPLICATION_NUMBER AS Associated_application_number,
       D.object_name AS Associated_Activity,
       B.MARKET_NAME,
       A.i_chronicle_id AS Correspondence_id,
       d.r_object_id AS Submission_id,
       B.R_VERSION_LABEL,
       TRUNC (a.STATUS_LAST_UPDATED - a.DOCUMENT_DATE) AS duration,
       'http://uw00016ek:8080/cara/drl/objectId/' || A.r_object_id || ''
          AS Document_URL,M.ROSTER_REGION,(SELECT MAX (IS_EEA)
                FROM COSMOSDBEXPORT.MARKET
               WHERE ISO_COUNTRY_NAME = b.MARKET_NAME)
                 IS_EEA,(SELECT MAX (IS_EU)
                FROM COSMOSDBEXPORT.MARKET
               WHERE ISO_COUNTRY_NAME = b.MARKET_NAME)
               IS_EU

  FROM COSMOSDBEXPORT.DOCUMENT A
       INNER JOIN COSMOSDBEXPORT.DOCUMENT_R B
          ON A.r_object_id = B.DOCUMENT_R_OBJECT_ID
       LEFT JOIN
       (SELECT C.correspondence_id,
               C.submission_manager_r_object_id,
               D.r_object_id,
               D.object_name,
               C.regulatory_application_name,
               D.IS_ACTIVE
          FROM COSMOSDBEXPORT.submission_manager_r C
               INNER JOIN COSMOSDBEXPORT.SUBMISSION_MANAGER D
                  ON D.r_object_id = C.submission_manager_r_object_id
         WHERE C.correspondence_id IS NOT NULL) D
          ON   D.correspondence_id = A.r_object_id 
       LEFT JOIN
       (SELECT A.APPLICATION_NUMBER, B.OBJECT_NAME
          FROM COSMOSDBEXPORT.REGULATORY_APPLICATION A
               INNER JOIN COSMOSDBEXPORT.OBJECT B
                  ON A.R_OBJECT_ID = B.R_OBJECT_ID) E
          ON B.REGULATORY_APPLICATION_NAME = E.OBJECT_NAME

left join COSMOSDBEXPORT.MARKET M on B.MARKET_NAME = M.ISO_COUNTRY_NAME
 WHERE A.CLASSIFICATION_DOMAIN = 'Correspondence')



 select "CORRESPONDENCE_NAME","FULL_TITLE","R_CREATION_DATE","R_MODIFY_DATE","R_MODIFIER","BUSINESS_UNIT","CLASSIFICATION_ARTIFACT","CLASSIFICATION_DOMAIN","CLASSIFICATION_GROUP","CLASSIFICATION_SUBGROUP","DOCUMENT_STATUS","DOCUMENT_DATE","INFORMATION_CLASSIFICATION","IS_ACTIVE","IS_ASSEMBLY","IS_GENERAL","R_OBJECT_ID","DOCUMENT_R_OBJECT_ID","APPLICATION_TYPE_NAME","APPLICATION_TYPE_UID","DOCUMENT_LANGUAGE","GLOBAL_PRODUCT_NAME","ORIGINATOR_COUNTRY_NAME","ORIGINATOR_COUNTRY_UID","PRODUCT_FAMILY_NAME","PRODUCT_FAMILY_UID","REGULATORY_APPLICATION_NAME","REGULATORY_APPLICATION_UID","TYPE_OF_COMMUNICATION","ASSOCIATED_APPLICATION_NUMBER","ASSOCIATED_ACTIVITY","MARKET_NAME","CORRESPONDENCE_ID","SUBMISSION_ID","R_VERSION_LABEL","DURATION","DOCUMENT_URL","ROSTER_REGION","IS_EEA","IS_EU"
 from first_view;
